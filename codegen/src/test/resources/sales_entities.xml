<?xml version="1.0"?>
<model name="sales" package="com.github.apuex.commerce.sales" dbSchema="sales">
  <entity name="product" aggregate="true">
    <field name="product_id" type="string" length="64" comment="商品编号"/>
    <field name="product_name" type="string" length="64" aggregate="true"  comment="商品名称"/>
    <field name="product_unit" type="string" length="64" aggregate="true" comment="计价单位"/>
    <field name="unit_price" type="double" aggregate="true" comment="单价"/>
    <field name="record_time" type="double" transient="true" comment="销量最后更新时间"/>
    <field name="quantity_sold" type="double" transient="true" comment="销量"/>
    <primaryKey name="product_pk">
      <field name="product_id"/>
    </primaryKey>
    <aggregate name="product_sales">
      <field name="record_time"/>
      <field name="quantity_sold"/>
    </aggregate>
  </entity>
  <entity name="order" aggregate="true">
    <field name="order_id" type="string" length="64" comment="订单编号"/>
    <field name="order_time" type="timestamp" comment="下单时间"/>
    <field name="order_lines" type="array" valueType="order_item" aggregate="true" comment="购买清单"/>
    <primaryKey name="order_pk">
      <field name="order_id"/>
    </primaryKey>
  </entity>
  <entity name="order_item" aggregatesTo="order">
    <field name="product_name" refField="product_name" refKey="order_item_product_fk" comment="商品名称"/>
    <field name="item_unit" type="string" length="64" comment="计价单位"/>
    <field name="unit_price" type="double" comment="单价"/>
    <field name="order_quantity" type="double" comment="数量"/>
    <primaryKey name="order_item_pk">
      <field name="order_id"/>
      <field name="product_id"/>
    </primaryKey>
    <foreignKey name="order_item_order_fk" refEntity="order">
      <field name="order_id" refField="order_id"/>
    </foreignKey>
    <foreignKey name="order_item_product_fk" refEntity="product">
      <field name="product_id" refField="product_id"/>
    </foreignKey>
  </entity>
</model>
