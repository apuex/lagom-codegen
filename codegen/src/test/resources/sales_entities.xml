<?xml version="1.0"?>
<model name="sales" package="com.github.apuex.commerce.sales" dbSchema="sales">
  <aggregate name="product" root="true">
    <field name="product_id" type="string" length="64"/>
    <field name="product_name" type="string" length="64" aggregate="true"/>
    <field name="product_unit" type="string" length="64" aggregate="true"/>
    <field name="unit_price" type="double" aggregate="true"/>
    <field name="record_time" type="double" transient="true"/>
    <field name="quantity_sold" type="double" transient="true"/>
    <primaryKey name="product_pk">
      <field name="product_id"/>
    </primaryKey>
    <aggregate name="product_sales">
      <field name="record_time"/>
      <field name="quantity_sold"/>
    </aggregate>
  </aggregate>
  <aggregate name="order" root="true">
    <field name="order_id" type="string" length="64"/>
    <field name="order_time" type="timestamp"/>
    <field name="order_lines" type="array" valueType="order_item" aggregate="true"/>
    <primaryKey name="order_pk">
      <field name="order_id"/>
    </primaryKey>
  </aggregate>
  <value-object name="order_item" aggregatesTo="order">
    <field name="product_name" refField="product_name" refKey="order_item_product_fk"/>
    <field name="item_unit" type="string" length="64"/>
    <field name="unit_price" type="double"/>
    <field name="order_quantity" type="double"/>
    <primaryKey name="order_item_pk">
      <field name="order_id"/>
      <field name="product_id"/>
    </primaryKey>
    <foreignKey name="order_item_order_fk">
      <field name="order_id"/>
    </foreignKey>
    <foreignKey name="order_item_product_fk">
      <field name="product_id"/>
    </foreignKey>
  </value-object>
</model>
